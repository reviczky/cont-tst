\setupbodyfont[dejavu]

\definetextbackground[a-normal][location=paragraph,mp=mpos:region:show]
\definetextbackground[a-shaped][location=paragraph,mp=mpos:region:show,method=mpos:regionshape]

\definetextbackground[b-normal][location=paragraph]
\definetextbackground[b-shaped][location=paragraph,method=mpos:regionshape]

\tracepositions

\starttext

    \starttextbackground[a-normal]
        \placefigure[right]{}{} \input ward \par \input ward
    \stoptextbackground

    \starttextbackground[a-normal]
        \placefigure[right]{}{} \input ward
    \stoptextbackground

    \page

    \starttextbackground[a-shaped]
        \placefigure[left]{}{} \input ward \input ward
    \stoptextbackground

    \blank[2*big]

    \starttextbackground[a-shaped]
        \placefigure[left]{}{} \input ward \par \input ward
    \stoptextbackground

    \page

%     \startnarrower
%         \starttextbackground[a-normal]
%             \input ward \par \input ward
%         \stoptextbackground
%     \stopnarrower

    \starttextbackground[a-shaped]
        \placefigure[right]{}{} \input ward \par \input ward
    \stoptextbackground

    \blank

    \starttextbackground[a-shaped]
        \placefigure[left]{}{} \input ward
    \stoptextbackground

    \blank

    \starttextbackground[a-shaped]
        \placefigure[right]{}{} \input ward
    \stoptextbackground

    \page

    \starttextbackground[a-shaped]
        \placefigure[right]{}{} \dorecurse{2}{test test test\par}
        \input ward
    \stoptextbackground

    \blank

    \starttextbackground[a-shaped]
        \placefigure[right]{}{} \dorecurse{20}{test test test\par}
    \stoptextbackground

    \page

    \starttextbackground[b-shaped]
        \placefigure[left]{}{} \input ward \input ward
    \stoptextbackground

    \blank

    \starttextbackground[b-shaped]
        \placefigure[left]{}{} \input ward \par \input ward
    \stoptextbackground

\stoptext
